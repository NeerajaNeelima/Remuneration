{% extends 'base.html' %}

{% block title %}Renumuration_Bill{% endblock %}
{% block additional_head %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='Renumuration_Bill.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='print.css') }}">
    {{ toastr.include_jquery() }}
    {{ toastr.include_toastr_css() }}
    {{ toastr.message() }}
{% endblock %}

{% block body %}
    
    <div class="p-1">
    <div class="border   shadow-lg p-2 mb-5 bg-body-tertiary rounded">
      <div class="d-sm-flex justify-content-md-center align-items-center" id="heading">
        <img src="{{url_for('static',filename='Images/jntugvcev.png')}}" alt="logo"/>
        <span class="heading">Jawaharla nehru technological university gurajada vizinagaram - 535003</span>
      </div>
      <form class="row g-3" >
        <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label" >Proceedings No / Purpose : </label>
            </div>
            <div class="col-auto ">
              <input type="text" id="inputPassword" class="bottom-bordered-input px-2" value="{{proceeding_no}}" aria-describedby="passwordHelpInline">
            </div>
        </div>
        <div class="row g-2 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label" >Name of the Examination : </label>
            </div>
            <div class="col-auto">
              <input type="text" id="inputPassword" class="bottom-bordered-input px-2" aria-describedby="passwordHelpInline" value="{{name_of_the_examination}}">
            </div>
            
        </div>
        <div class="col-md-6">
          <div class="row g-2 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label" >Name of the Subject : </label>
            </div>
            <div class="col-auto ">
              <input type="text" id="inputPassword" class="bottom-bordered-input-2 px-2"  aria-describedby="passwordHelpInline" value="{{subject_name}}">
            </div>
                      
          </div>
        </div>
        <div class="col-md-4">
          <div class="row g-2 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label">Subject Code :</label>
            </div>
            <div class="col-auto ">
              <input type="text" id="inputPassword" class="bottom-bordered-input-3 px-2" aria-describedby="passwordHelpInline" value="{{subject_code}}">
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="row g-2 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label">Name of the Staff: </label>
            </div>
            <div class="col-auto ">
              <input type="text" id="inputPassword" class="bottom-bordered-input-2 px-2" aria-describedby="passwordHelpInline" value="{{name_of_the_staff}}" name="name_of_the_staff">
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="row g-2 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label">Phone No :</label>
            </div>
            <div class="col-auto ">
              <input type="text" id="inputPassword" class="bottom-bordered-input-3 px-2" aria-describedby="passwordHelpInline" value="{{phone_no}}">
            </div>
          </div>
        </div>
        <div class="row g-2 align-items-center">
          <div class="col-auto">
            <label for="inputPassword6" class="col-form-label">Designation & Address : </label>
          </div>
          <div class="col-auto ">
            <input type="text" id="inputPassword" class="bottom-bordered-input px-2" aria-describedby="passwordHelpInline" value="{{designation}}">
          </div>
        </div>
       <div class="col-auto d-flex gap-2" style="margin-top: -5px;">
          <label for="inputPassword6" class="col-form-label mt-3  ">PAN No : </label>
          <input name="pan_number" value="{{pan_number}}" style="display: none;"/>
            <table class="table table-bordered border table_custom ">
              <tr>
                {% for digit in pan_number %}
                <td style="padding: 0;">
                  <input type="text"  style="height: 33px; width: 30px; text-align: center;" value="{{ digit }}">
                  <!--<input type="text" style="height: 33px; width: 30px; text-align: center;" value="{{digit}}" name="{{digit}}">-->
                </td>
                {% endfor %}
              </tr>
            </table>
        </div>
        <div class="col-auto d-flex gap-2" style="margin-top: -5px;">
            <label for="inputPassword6" class="col-form-label mt-3 ">Bank A/C No : </label>
            <input type="hidden" value="{{bank_account_no}}" name="bank_account_no"/>
            <table class="table table-bordered border table_custom ">
              <tr>
                {% for digit in bank_account_no %}
                <td style="padding: 0;">
                    <input type="text" style="height: 33px; width: 30px; text-align: center;" value="{{ digit }}">
                </td>
                {% endfor %}
            </tr>
            </table>
        </div>
        <div class="row g-3" style="margin-top: -30px;">
            <div class="col-md-6">
              <div class="row g-3 align-items-center">
                  <div class="col-auto">
                    <label for="inputPassword6" class="col-form-label">IFSC Code : </label>
                    <input type="hidden" value="{{ifsc_code}}" name="ifsc_code"/>
                  </div>
                  <div class="col-auto ">
                    <input type="text" id="inputPassword6" class="bottom-bordered-input-4 " aria-describedby="passwordHelpInline" value="{{ifsc_code}}">
                  </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="row g-3 align-items-center">
                  <div class="col-auto">
                    <label for="inputPassword6" class="col-form-label">Branch :</label>
                  </div>
                  <div class="col-auto ">
                    <input type="text" id="inputPassword6" class="bottom-bordered-input-4 " aria-describedby="passwordHelpInline">
                  </div>
              </div>
            </div>
        </div>
      
        <table class="table table-sm table-bordered border-2 mt-2 p-1" id="table_custom">
            <tr>
              <th>S.No</th>
              <th >Natrue of Work</th>
              <th colspan="2">Number</th>
            
              <th>Rate(Rs)</th>
              <th>Total(Rs)</th>
            </tr>
            <tr>
                <td>1.</td>
        <td  style="padding: 0;" name="transaction_type_1" id="transaction_type_1">Paper Setting</td>
        <td style="padding: 0;">
          
          No of Sets</td>
        <td style="padding: 0;"><input type="number" id="quantity_1" name="quantity_1" style="height: 40px;" oninput="calculateRowTotal(1)"/></td>
        <td style="padding: 0;"><input type="number" id="rate_1" name="rate_1" style="height: 40px;" oninput="calculateRowTotal(1)"/></td>
        <td id="total_1">0</td>
            </tr>
            <tr>
                <td>2.</td>
      <td style="padding: 0;" id="transaction_type_2" name="transaction_type_2">Scehme of Valuation</td>
      <td style="padding: 0;">No of Sets</td>
      <td style="padding: 0;"><input type="number" id="quantity_2" name="quantity_2" style="height: 40px;" oninput="calculateRowTotal(2)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_2" name="rate_2" style="height: 40px;" oninput="calculateRowTotal(2)" /></td>
      <td id="total_2">0</td>
            </tr>
            <tr>
                <td>3.</td>
                <td>Paper Valuation</td>
      <td style="padding: 0;" id="transaction_type_3" name="transaction_type_3">No of Papers</td>
      <td style="padding: 0;"><input type="number" id="quantity_3" name="quantity_3" style="height: 40px;" oninput="calculateRowTotal(3)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_3" name="rate_3" style="height: 40px;" oninput="calculateRowTotal(3)" /></td>
      <td id="total_3">0</td>
            </tr>
            <tr>
                <td>4.</td>
                <td>Chief Examiner</td>
      <td style="padding: 0;" id="transaction_type_4" name="transaction_type_4">No of Papers</td>
      <td style="padding: 0;"><input type="number" id="quantity_4" name="quantity_4" style="height: 40px;" oninput="calculateRowTotal(4)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_4" name="rate_4" style="height: 40px;" oninput="calculateRowTotal(4)" /></td>
      <td id="total_4">0</td>
            </tr>
            <tr>
                <td>5.</td>
                <td>Scrutinizer</td>
      <td style="padding: 0;" id="transaction_type_5" name="transaction_type_5">No of Papers</td>
      <td style="padding: 0;"><input type="number" id="quantity_5" name="quantity_5" style="height: 40px;" oninput="calculateRowTotal(5)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_5" name="rate_5" style="height: 40px;" oninput="calculateRowTotal(5)" /></td>
      <td id="total_5">0</td>
            </tr>
            <tr>
                <td>6.</td>
                <td>Invigilation</td>
      <td style="padding: 0;" id="transaction_type_6" name="transaction_type_6">No of Sessions</td>
      <td style="padding: 0;"><input type="number" id="quantity_6" name="quantity_6" style="height: 40px;" oninput="calculateRowTotal(6)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_6" name="rate_6" style="height: 40px;" oninput="calculateRowTotal(6)" /></td>
      <td id="total_6">0</td>
            </tr>
            <tr>
                <td>7.</td>
                <td>Lab Examiner</td>
      <td style="padding: 0;" id="transaction_type_7" name="transaction_type_7">No of Sessions</td>
      <td style="padding: 0;"><input type="number" id="quantity_7" name="quantity_7" style="height: 40px;" oninput="calculateRowTotal(7)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_7" name="rate_7" style="height: 40px;" oninput="calculateRowTotal(7)" /></td>
      <td id="total_7">0</td>
            </tr>
            <tr>
                <td>8.</td>
                <td>Lab Skilled Assistant</td>
      <td style="padding: 0;" id="transaction_type_8" name="transaction_type_8">No of Batches
      <td style="padding: 0;"><input type="number" id="quantity_8" name="quantity_8" style="height: 40px;" oninput="calculateRowTotal(8)" /></td>
      <td style="padding: 0;"><input type="number" id="rate_8" name="rate_8" style="height: 40px;" oninput="calculateRowTotal(8)" /></td>
      <td id="total_8">0</td>
            </tr>
            <tr>
                <td>9.</td>
                <td>Lab Record Assistant</td>
      <td  id="transaction_type_9" name="transaction_type_9">No of Batches </td>
      <td ><input type="number" id="quantity_9" name="quantity_9" style="height: 40px;" oninput="calculateRowTotal(9)" /></td>
      <td ><input type="number" id="rate_9" name="rate_9" style="height: 40px;" oninput="calculateRowTotal(9)" /></td>
      <td id="total_9">0</td>
            </tr>
            <tr>
                <td>10.</td>
                <td>Observer</td>
      <td  id="transaction_type_10" name="transaction_type_10">No of Sessions</td>
      <td ><input type="number" id="quantity_10" name="quantity_10" style="height: 40px;" oninput="calculateRowTotal(10)" /></td>
      <td><input type="number" id="rate_10" name="rate_10" style="height: 40px;" oninput="calculateRowTotal(10)" /></td>
      <td id="total_10">0</td>
            </tr>
            <tr>
                <td>11.</td>
                <td>Question Bank</td>
      <td id="transaction_type_11" name="transaction_type_11">No of Questions</td>
      <td ><input type="number" id="quantity_11" name="quantity_11" style="height: 40px;" oninput="calculateRowTotal(11)" /></td>
      <td ><input type="number" id="rate_11" name="rate_11" style="height: 40px;" oninput="calculateRowTotal(11)" /></td>
      <td id="total_11">0</td>
            </tr>
            <tr>
                <td>12.</td>
                <td>Moderator</td>
      <td id="transaction_type_12" name="transaction_type_12">No of QB's </td>
      <td ><input type="number" id="quantity_12" name="quantity_12" style="height: 40px;" oninput="calculateRowTotal(12)" /></td>
      <td ><input type="number" id="rate_12" name="rate_12" style="height: 40px;" oninput="calculateRowTotal(12)" /></td>
      <td id="total_12">0</td>
            </tr>
            <tr>
                <td>13.</td>
                <td>Thesis Viva Voice</td>
      <td  id="transaction_type_13" name="transaction_type_13">No of Students</td>
      <td><input type="number" id="quantity_13" name="quantity_13" style="height: 40px;" oninput="calculateRowTotal(13)" /></td>
      <td ><input type="number" id="rate_13" name="rate_13" style="height: 40px;" oninput="calculateRowTotal(13)" /></td>
      <td id="total_13">0</td>
            </tr>
            <tr>
                <td>14.</td>
                <td id="transaction_type_14" name="transaction_type_14">Other(Specify below)</td>
                <td >No of Sets</td>
                <td><input type="number" id="quantity_14" name="quantity_14" style="height: 40px;" oninput="calculateRowTotal(14)" /></td>
                <td ><input type="number" id="rate_14" name="rate_14" style="height: 40px;" oninput="calculateRowTotal(14)" /></td>
                <td id="total_14">0</td>
            </tr>
            <tr>
            <th colspan="4"></th>
              <th>Total</th>
              <th id="finalTotal">0</th>
            </tr>
            <tr>
              <th colspan="4"></th>
              <th>T.D.S(10%)Deduction</th>
              <th id="tdsDeduction">0</th>
            </tr>
            <tr>
              <th colspan="4"></th>
              <th>Grand Total</th>
              <th id="grandTotal"  >
                0
               
              </th>
            </tr>
        </table>
        <input type="hidden" name="grandTotal" id="hiddenGrandTotal" value="0">
        <input type="hidden" name="transaction_type" id="hiddenTransactionType"/>
        <div style="display: flex; flex-direction: column;">
            <div class="text" style="margin-top: -30px;">Received Rupees</div>
            <input type="text" style="border-bottom: ridge;"/>
        </div>
        <span class="text" style="margin-top: -4px;">only I certify that the work assigned is completed and this biil
          is not claimed earlier form any source.</span>
        <div class="station">
          <div class="left  text" style="margin-top: -13px;">Station :</div>
          <div class="right  text"> 
            <table class="table-bordered border table3">
              <tr>
                <th>Stamp</th>
              </tr>
            </table>
          </div>
        </div>
        <div class="station ">
          <div class="left  text" style="margin-top: -25px;">Date :</div>
          <div class="right text" style="margin-top: 20px;"> 
            Signature 
          </div>
        </div>
        <div class="text-center text" style="margin-top: -20px;">
          For Office Use Only
        </div>
        <div style="display: flex; flex-direction: column;" >
          <p>
            <div class="text" style="margin-top: -20px;">The bill is passed for Rs. </div>
          </p>
          <input type="text" style="border-bottom: ridge; margin-top: -9px;"/>
        </div>
        <sapn class="text" style="margin-top: -6px;">only</sapn>
        <div class="d-flex justify-content-between text" id="footer" style="margin-top: 50px;">
          <div>Clerk</div>
          <div>A/S</div>
          <div>Addl.Contoller of Examination</div>
          <div><h2>D.E./C.E.</h2></div>
        </div>
      </div>
    </div>
  </div>
  <div class=" d-flex gap-5 justify-content-center mb-5" id="sub_print">
    <button type="submit"  class="btn btn-primary"  id="submit">Submit</button>
    <button onclick="window.print()" class="btn btn-primary" id="print">Print</button>
  <div>
  </form>
  {% endblock %}
  {% block additional_scripts %}  
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      function calculateRowTotal(rowNumber) {
          // Get the quantity and rate input values
          var quantity = parseFloat(document.getElementById('quantity_' + rowNumber).value) || 0;
          var rate = parseFloat(document.getElementById('rate_' + rowNumber).value) || 0;
      
          // Calculate the total for the row
          var total = quantity * rate;
      
          // Update the total cell for the row
          document.getElementById('total_' + rowNumber).innerText = total.toFixed(2);
          var transactionType = document.getElementById('transaction_type_' + rowNumber).innerText;
          document.getElementById('hiddenTransactionType').value = transactionType;
          // Recalculate the finalTotal, tdsDeduction, and grandTotal
          calculateFinalTotal();
        }
      
        function calculateFinalTotal() {
          var finalTotal = 0;
      
          // Loop through all rows and sum up the totals
          for (var i = 1; i <= 14; i++) {
            finalTotal += parseFloat(document.getElementById('total_' + i).innerText) || 0;
          }
      
          // Calculate T.D.S(10%) Deduction
          var tdsDeduction = 0.1 * finalTotal;
      
          // Calculate Grand Total
          var grandTotal = finalTotal - tdsDeduction;
      
          // Update the finalTotal, tdsDeduction, and grandTotal cells
          document.getElementById('finalTotal').innerText = finalTotal.toFixed(2);
          document.getElementById('tdsDeduction').innerText = tdsDeduction.toFixed(2);
          document.getElementById('grandTotal').innerText = grandTotal.toFixed(2);
          console.log(document.getElementById('hiddenGrandTotal').value = grandTotal.toFixed(2));
        }

        document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('submit').addEventListener('click', function(event) {
      event.preventDefault();
      
      // Use FormData to serialize the form data
      var formData = new FormData(document.querySelector('form'));
      
      // Use fetch to make a POST request to the server
      fetch('/bill_submitted', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        // Check the status from the response and display toastr messages
        if (data.status === 'success') {
          //toastr.success(data.message, 'Success');
          // You can redirect or perform other actions on success
          window.location.href = "/success";
        } else {
          toastr.error(data.message, 'Error');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        toastr.error('An unexpected error occurred', 'Error');
      });
    });
  });
        
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
{{ toastr.include_toastr_js() }}
{% endblock %}





